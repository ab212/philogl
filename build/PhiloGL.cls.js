(function(){function t(x){return document.getElementById(x)}this.PhiloGL=null;(function(){PhiloGL=function(x,w){function l(q,v,r){var z=q.canvas,a=new PhiloGL.Camera(i.fov,i.aspect||z.width/z.height,i.near,i.far,i);a.update();var b=new PhiloGL.Scene(v,a,c);L=new PhiloGL.WebGL.Application({gl:q,canvas:z,program:v,scene:b,camera:a});v.$$family=="program"&&v.use();e&&PhiloGL.Events.create(L,t.extend(e,{bind:L}));if(d.src.length)new PhiloGL.IO.Textures(t.extend(d,{onComplete:function(){r(L)}}));else r(L)}
w=t.merge({context:{},camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:t.empty,onError:t.empty},w||{});var m=w.context,i=w.camera,e=w.events,d=w.textures,g=t.splat(w.program),c=w.scene;o=PhiloGL.WebGL.getContext(x,m);if(!o){w.onError("The WebGL context couldn't been initialized");return null}var h={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},j=g.length,k=function(){var q=
j,v={},r=false;return{onSuccess:function(z,a){v[a.id||j-q]=z;q--;if(q===0&&!r)l(o,j==1?z:v,function(b){w.onLoad(b)})},onError:function(z){q--;w.onError(z);r=true}}}();g.forEach(function(q){var v=q.from,r,z;for(z in h)if(v==z){try{r=PhiloGL.Program[h[z]](t.extend(k,q))}catch(a){k.onError(a)}break}if(r)k.onSuccess(r,q)})}})();PhiloGL.unpack=function(x){x=x||$;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx","Media"].forEach(function(w){x[w]=PhiloGL[w]});
x.gl=o;x.Utils=t};PhiloGL.version="1.5.2";var o,L,$=this;t.empty=function(){};t.time=Date.now;t.uid=function(){var x=t.time();return function(){return x++}}();t.extend=function(x,w){for(var l in w)x[l]=w[l];return x};t.type=function(){var x=Object.prototype.toString;return function(w){var l;l=x.call(w);l=l.substr(8,l.length-9).toLowerCase();if(l!="object")return l;if(w.$$family)return w.$$family;return w&&w.nodeName&&w.nodeType==1?"element":l}}();(function(){function x(w){var l=t.type(w);if(l=="object"){l=
{};for(var m in w)l[m]=x(w[m]);return l}else if(l=="array"){l=[];m=0;for(var i=w.length;m<i;m++)l[m]=x(w[m]);return l}else return w}t.merge=function(){for(var w={},l=0,m=arguments.length;l<m;l++){var i=arguments[l];if(t.type(i)=="object")for(var e in i){var d=i[e],g=w[e];w[e]=g&&t.type(d)=="object"&&t.type(g)=="object"?t.merge(g,d):x(d)}}return w}})();t.splat=function(){var x=Array.isArray;return function(w){return x(w)&&w||[w]}}();(function(){function x(l){for(var m in l)this[m]=l[m];this.buffers=
{};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var w={getContext:function(l,m){l=typeof l=="string"?t(l):l;var i;(i=l.getContext("experimental-webgl",m))||(i=l.getContext("webgl",m));if(i&&m&&m.debug){o={};for(var e in i){var d=i[e];o[e]=typeof d=="function"?function(g,c){return function(){console.log(g,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var h=c.apply(i,
arguments)}catch(j){throw g+" "+j;}for(var k=[],q;(q=i.getError())!==i.NO_ERROR;)k.push(q);if(k.length)throw k.join();return h}}(e,d):d}}else o=i;if(o)o.get=function(g){return typeof g=="string"?o[g]:g};return o}};x.prototype={$$family:"application",setBuffer:function(l,m,i){if(i===false||i===null){(i=this.bufferMemo[m])&&o.bindBuffer(i.bufferType,null);var e=i&&i.attribute||m;l=l.attributes[e];l!==undefined&&o.disableVertexAttribArray(l)}else{i=t.extend(this.bufferMemo[m]||{bufferType:o.ARRAY_BUFFER,
size:1,dataType:o.FLOAT,stride:0,offset:0,drawType:o.STATIC_DRAW},i||{});e=i.attribute||m;var d=i.bufferType,g=m in this.buffers,c=g?this.buffers[m]:o.createBuffer(),h="value"in i,j=i.value,k=i.size,q=i.dataType,v=i.stride,r=i.offset,z=i.drawType;l=l.attributes[e];var a=l!==undefined;g||(this.buffers[m]=c);a&&o.enableVertexAttribArray(l);o.bindBuffer(d,c);h&&o.bufferData(d,j,z);a&&o.vertexAttribPointer(l,k,q,false,v,r);delete i.value;this.bufferMemo[m]=i;if(a)this.bufferMemo[e]=i;return this}},setBuffers:function(l,
m){for(var i in m)this.setBuffer(l,i,m[i]);return this},setFrameBuffer:function(l,m){if(typeof m!="object")o.bindFramebuffer(o.FRAMEBUFFER,m?this.frameBuffers[l]:null);else{m=t.merge(this.frameBufferMemo[l]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:o.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:o.DEPTH_ATTACHMENT}},m||{});var i=m.bindToTexture,e=m.bindToRenderBuffer,d=l in this.frameBuffers,g=d?this.frameBuffers[l]:o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,
g);d||(this.frameBuffers[l]=g);if(i){i=t.merge({data:{width:m.width,height:m.height}},t.type(i)=="object"?i:{});d=l+"-texture";g=m.textureOptions;this.setTexture(d,i);o.framebufferTexture2D(o.FRAMEBUFFER,g.attachment,this.textureMemo[d].textureType,this.textures[d],0)}if(e){e=t.extend({width:m.width,height:m.height},t.type(e)=="object"?e:{});i=l+"-renderbuffer";d=m.renderBufferOptions;this.setRenderBuffer(i,e);o.framebufferRenderbuffer(o.FRAMEBUFFER,d.attachment,o.RENDERBUFFER,this.renderBuffers[i])}o.bindTexture(o.TEXTURE_2D,
null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null);this.frameBufferMemo[l]=m;return this}},setFrameBuffers:function(l){for(var m in l)this.setFrameBuffer(m,l[m]);return this},setRenderBuffer:function(l,m){if(typeof m!="object")o.bindRenderbuffer(o.RENDERBUFFER,m?this.renderBufferMemo[l]:null);else{m=t.extend(this.renderBufferMemo[l]||{storageType:o.DEPTH_COMPONENT16,width:0,height:0},m||{});var i=l in this.renderBuffers,e=i?this.renderBuffers[l]:o.createRenderbuffer(o.RENDERBUFFER);
i||(this.renderBuffers[l]=e);o.bindRenderbuffer(o.RENDERBUFFER,e);o.renderbufferStorage(o.RENDERBUFFER,m.storageType,m.width,m.height);this.renderBufferMemo[l]=m;return this}},setRenderBuffers:function(l){for(var m in l)this.setRenderBuffer(m,l[m]);return this},setTexture:function(l,m){if(!m||typeof m!="object"){o.activeTexture(m||o.TEXTURE0);o.bindTexture(this.textureMemo[l].textureType||o.TEXTURE_2D,this.textures[l])}else{if(m.data&&m.data.type===o.FLOAT)if(!o.getExtension("OES_texture_float"))throw"OES_texture_float is not supported";
m=t.merge(this.textureMemo[l]||{textureType:o.TEXTURE_2D,pixelStore:[{name:o.UNPACK_FLIP_Y_WEBGL,value:true},{name:o.UNPACK_ALIGNMENT,value:1}],parameters:[{name:o.TEXTURE_MAG_FILTER,value:o.NEAREST},{name:o.TEXTURE_MIN_FILTER,value:o.NEAREST},{name:o.TEXTURE_WRAP_S,value:o.CLAMP_TO_EDGE},{name:o.TEXTURE_WRAP_T,value:o.CLAMP_TO_EDGE}],data:{format:o.RGBA,value:false,type:o.UNSIGNED_BYTE,width:0,height:0,border:0}},m||{});var i="textureType"in m?m.textureType=o.get(m.textureType):o.TEXTURE_2D,e="textureTarget"in
m?m.textureTarget=o.get(m.textureTarget):i,d=i==o.TEXTURE_CUBE_MAP,g=l in this.textures,c=g?this.textures[l]:o.createTexture(),h=m.pixelStore,j=m.parameters,k=m.data,q=k.value,v=k.type,r=k.format,z=!!k.value;g||(this.textures[l]=c);o.bindTexture(i,c);g||h.forEach(function(a){a.name=typeof a.name=="string"?o.get(a.name):a.name;o.pixelStorei(a.name,a.value)});if(z)if(d)for(c=0;c<6;++c)(k.width||k.height)&&!q.width&&!q.height?o.texImage2D(e[c],0,r,k.width,k.height,k.border,r,v,q[c]):o.texImage2D(e[c],
0,r,r,v,q[c]);else(k.width||k.height)&&!q.width&&!q.height?o.texImage2D(e,0,r,k.width,k.height,k.border,r,v,q):o.texImage2D(e,0,r,r,v,q);else if(k.width||k.height)o.texImage2D(e,0,r,k.width,k.height,k.border,r,v,null);if(!g)for(c=0;c<j.length;c++){e=j[c];e.name=o.get(e.name);e.value=o.get(e.value);o.texParameteri(i,e.name,e.value);e.generateMipmap&&o.generateMipmap(i)}m.isCube=d;if(z)m.data.value=false;this.textureMemo[l]=m;return this}},setTextures:function(l){for(var m in l)this.setTexture(m,l[m]);
return this},use:function(l){o.useProgram(l.program);this.usedProgram=l;return this}};w.Application=x;(function(){try{var l=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(l.getContext("webgl")||l.getContext("experimental-webgl")))}}catch(m){PhiloGL.hasWebGL=function(){return false}}PhiloGL.hasExtension=function(i){if(!PhiloGL.hasWebGL())return false;var e=document.createElement("canvas");return(e.getContext("webgl")||e.getContext("experimental-webgl")).getExtension(i)}})();
PhiloGL.WebGL=w})();(function(){function x(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var w=Math.sqrt,l=Math.sin,m=Math.cos,i=Math.tan,e=Math.PI,d=Array.prototype.slice,g=this.Float32Array,c=function(){if(!g||!g.call)return Array;try{g.call({},10)}catch(a){return Array}return g}(),h=c!=Array,j=function(a,b,f){if(h){g.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=f||0}else this.push(a||0,b||0,f||0);this.typedContainer=new g(3)};j.create=
function(){return new g(3)};j.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},x:x(0),y:x(1),z:x(2)});var k={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,f,n){a[0]=b;a[1]=f;a[2]=n;return a},add:function(a,b){return new j(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,f){a[0]=b[0]+f[0];a[1]=b[1]+f[1];a[2]=b[2]+f[2];return a},sub:function(a,b){return new j(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,
b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,f){a[0]=b[0]-f[0];a[1]=b[1]-f[1];a[2]=b[2]-f[2];return a},scale:function(a,b){return new j(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new j(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=j.norm(a);if(b>0)return j.scale(a,1/b);return j.clone(a)},$unit:function(a){var b=j.norm(a);if(b>0)return j.$scale(a,1/b);return a},cross:function(a,
b){var f=a[0],n=a[1],p=a[2],s=b[0],u=b[1],y=b[2];return new j(n*y-p*u,p*s-f*y,f*u-n*s)},$cross:function(a,b){var f=a[0],n=a[1],p=a[2],s=b[0],u=b[1],y=b[2];a[0]=n*y-p*u;a[1]=p*s-f*y;a[2]=f*u-n*s;return a},distTo:function(a,b){var f=a[0]-b[0],n=a[1]-b[1],p=a[2]-b[2];return w(f*f+n*n+p*p)},distToSq:function(a,b){var f=a[0]-b[0],n=a[1]-b[1],p=a[2]-b[2];return f*f+n*n+p*p},norm:function(a){var b=a[0],f=a[1];a=a[2];return w(b*b+f*f+a*a)},normSq:function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a},dot:function(a,
b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new j(a[0],a[1],a[2]):j.setVec3(new g(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},q=j.prototype,v;for(v in k){j[v]=k[v];q[v]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return j[a].apply(j,b)}}(v)}var r=function(a,b,f,n,p,s,u,y,A,B,C,D,F,H,I,G){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,f,n,p,s,u,y,A,B,C,D,F,
H,I,G):this.id();this.typedContainer=new g(16)};r.create=function(){return new g(16)};r.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:x(0),n12:x(4),n13:x(8),n14:x(12),n21:x(1),n22:x(5),n23:x(9),n24:x(13),n31:x(2),n32:x(6),n33:x(10),n34:x(14),n41:x(3),n42:x(7),n43:x(11),n44:x(15)});k={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new r(a[0],a[4],a[8],
a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new g(a)},set:function(a,b,f,n,p,s,u,y,A,B,C,D,F,H,I,G,E){a[0]=b;a[4]=f;a[8]=n;a[12]=p;a[1]=s;a[5]=u;a[9]=y;a[13]=A;a[2]=B;a[6]=C;a[10]=D;a[14]=F;a[3]=H;a[7]=I;a[11]=G;a[15]=E;return a},mulVec3:function(a,b){var f=j.clone(b);return r.$mulVec3(a,f)},$mulVec3:function(a,b){var f=b[0],n=b[1],p=b[2],s=1/(a[3]*f+a[7]*n+a[11]*p+a[15]);b[0]=(a[0]*f+a[4]*n+a[8]*p+a[12])*s;b[1]=(a[1]*f+a[5]*n+a[9]*p+a[13])*s;b[2]=(a[2]*f+a[6]*n+a[10]*
p+a[14])*s;return b},mulMat42:function(a,b,f){var n=b[0],p=b[1],s=b[2],u=b[3],y=b[4],A=b[5],B=b[6],C=b[7],D=b[8],F=b[9],H=b[10],I=b[11],G=b[12],E=b[13],M=b[14];b=b[15];var J=f[0],K=f[1],O=f[2],P=f[3],Q=f[4],T=f[5],U=f[6],V=f[7],R=f[8],S=f[9],W=f[10],N=f[11],X=f[12],Y=f[13],Z=f[14];f=f[15];a[0]=J*n+K*y+O*D+P*G;a[1]=J*p+K*A+O*F+P*E;a[2]=J*s+K*B+O*H+P*M;a[3]=J*u+K*C+O*I+P*b;a[4]=Q*n+T*y+U*D+V*G;a[5]=Q*p+T*A+U*F+V*E;a[6]=Q*s+T*B+U*H+V*M;a[7]=Q*u+T*C+U*I+V*b;a[8]=R*n+S*y+W*D+N*G;a[9]=R*p+S*A+W*F+N*E;a[10]=
R*s+S*B+W*H+N*M;a[11]=R*u+S*C+W*I+N*b;a[12]=X*n+Y*y+Z*D+f*G;a[13]=X*p+Y*A+Z*F+f*E;a[14]=X*s+Y*B+Z*H+f*M;a[15]=X*u+Y*C+Z*I+f*b;return a},mulMat4:function(a,b){var f=r.clone(a);return r.mulMat42(f,a,b)},$mulMat4:function(a,b){return r.mulMat42(a,a,b)},add:function(a,b){var f=r.clone(a);return r.$add(f,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=
b[15];return a},transpose:function(a){a=r.clone(a);return r.$transpose(a)},$transpose:function(a){var b=a[8],f=a[12],n=a[1],p=a[9],s=a[13],u=a[2],y=a[6],A=a[14],B=a[3],C=a[7],D=a[11];a[1]=a[4];a[2]=b;a[3]=f;a[4]=n;a[6]=p;a[7]=s;a[8]=u;a[9]=y;a[11]=A;a[12]=B;a[13]=C;a[14]=D;return a},rotateAxis:function(a,b,f){a=r.clone(a);return r.$rotateAxis(a,b,f)},$rotateAxis:function(a,b,f){var n=l(b),p=m(b),s=1-p,u=f[0],y=f[1],A=f[2];f=u*u*s+p;b=u*y*s+A*n;var B=u*A*s-y*n,C=y*u*s-A*n,D=y*y*s+p,F=y*A*s+u*n,H=u*
A*s+y*n;n=y*A*s-u*n;p=A*A*s+p;s=a[0];u=a[1];y=a[2];A=a[3];var I=a[4],G=a[5],E=a[6],M=a[7],J=a[8],K=a[9],O=a[10],P=a[11];a[0]=s*f+I*b+J*B;a[1]=u*f+G*b+K*B;a[2]=y*f+E*b+O*B;a[3]=A*f+M*b+P*B;a[4]=s*C+I*D+J*F;a[5]=u*C+G*D+K*F;a[6]=y*C+E*D+O*F;a[7]=A*C+M*D+P*F;a[8]=s*H+I*n+J*p;a[9]=u*H+G*n+K*p;a[10]=y*H+E*n+O*p;a[11]=A*H+M*n+P*p;return a},rotateXYZ:function(a,b,f,n){a=r.clone(a);return r.$rotateXYZ(a,b,f,n)},$rotateXYZ:function(a,b,f,n){var p=a[0],s=a[1],u=a[2],y=a[3],A=a[4],B=a[5],C=a[6],D=a[7],F=a[8],
H=a[9],I=a[10],G=a[11],E=m(b),M=m(f),J=m(n);b=l(b);var K=l(f),O=l(n);n=M*J;f=-E*O+b*K*J;var P=b*O+E*K*J,Q=M*O,T=E*J+b*K*O;J=-b*J+E*K*O;K=-K;b*=M;E*=M;a[0]=p*n+A*Q+F*K;a[1]=s*n+B*Q+H*K;a[2]=u*n+C*Q+I*K;a[3]=y*n+D*Q+G*K;a[4]=p*f+A*T+F*b;a[5]=s*f+B*T+H*b;a[6]=u*f+C*T+I*b;a[7]=y*f+D*T+G*b;a[8]=p*P+A*J+F*E;a[9]=s*P+B*J+H*E;a[10]=u*P+C*J+I*E;a[11]=y*P+D*J+G*E;return a},translate:function(a,b,f,n){a=r.clone(a);return r.$translate(a,b,f,n)},$translate:function(a,b,f,n){a[12]=a[0]*b+a[4]*f+a[8]*n+a[12];a[13]=
a[1]*b+a[5]*f+a[9]*n+a[13];a[14]=a[2]*b+a[6]*f+a[10]*n+a[14];a[15]=a[3]*b+a[7]*f+a[11]*n+a[15];return a},scale:function(a,b,f,n){a=r.clone(a);return r.$scale(a,b,f,n)},$scale:function(a,b,f,n){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=f;a[5]*=f;a[6]*=f;a[7]*=f;a[8]*=n;a[9]*=n;a[10]*=n;a[11]*=n;return a},invert:function(a){a=r.clone(a);return r.$invert(a)},$invert:function(a){var b=a[0],f=a[1],n=a[2],p=a[3],s=a[4],u=a[5],y=a[6],A=a[7],B=a[8],C=a[9],D=a[10],F=a[11],H=a[12],I=a[13],G=a[14],E=a[15],M=b*u-
f*s,J=b*y-n*s,K=b*A-p*s,O=f*y-n*u,P=f*A-p*u,Q=n*A-p*y,T=B*I-C*H,U=B*G-D*H,V=B*E-F*H,R=C*G-D*I,S=C*E-F*I,W=D*E-F*G,N=1/(M*W-J*S+K*R+O*V-P*U+Q*T);a[0]=(+u*W-y*S+A*R)*N;a[1]=(-f*W+n*S-p*R)*N;a[2]=(+I*Q-G*P+E*O)*N;a[3]=(-C*Q+D*P-F*O)*N;a[4]=(-s*W+y*V-A*U)*N;a[5]=(+b*W-n*V+p*U)*N;a[6]=(-H*Q+G*K-E*J)*N;a[7]=(+B*Q-D*K+F*J)*N;a[8]=(+s*S-u*V+A*T)*N;a[9]=(-b*S+f*V-p*T)*N;a[10]=(+H*P-I*K+E*M)*N;a[11]=(-B*P+C*K-F*M)*N;a[12]=(-s*R+u*U-y*T)*N;a[13]=(+b*R-f*U+n*T)*N;a[14]=(-H*O+I*J-G*M)*N;a[15]=(+B*O-C*J+D*M)*N;
return a},lookAt:function(a,b,f,n){f=j.sub(b,f);f.$unit();n=j.cross(n,f);n.$unit();var p=j.cross(f,n);p.$unit();return r.set(a,n[0],n[1],n[2],-n.dot(b),p[0],p[1],p[2],-p.dot(b),f[0],f[1],f[2],-f.dot(b),0,0,0,1)},frustum:function(a,b,f,n,p,s,u){var y=f-b,A=p-n,B=u-s;a[0]=s*2/y;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=s*2/A;a[6]=0;a[7]=0;a[8]=(f+b)/y;a[9]=(p+n)/A;a[10]=-(u+s)/B;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(u*s*2)/B;a[15]=0;return a},perspective:function(a,b,f,n,p){b=n*i(b*e/360);var s=-b;return r.frustum(a,
s*f,b*f,s,b,n,p)},ortho:function(a,b,f,n,p,s,u){var y=f-b,A=n-p,B=u-s;a[0]=2/y;a[4]=0;a[8]=0;a[12]=-((f+b)/y);a[1]=0;a[5]=2/A;a[9]=0;a[13]=-((n+p)/A);a[2]=0;a[6]=0;a[10]=-2/B;a[14]=-((u+s)/B);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};q=r.prototype;for(v in k){r[v]=
k[v];q[v]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return r[a].apply(r,b)}}(v)}var z=function(a,b,f,n){c.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=f||0;this[3]=n||0;this.typedContainer=new g(4)};z.create=function(){return new g(4)};k={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,f,n,p){a[0]=b||0;a[1]=f||0;a[2]=n||0;a[3]=p||0;return a},clone:function(a){return a.$$family?new z(a[0],a[1],a[2],a[3]):z.setQuat(new g(4),a)},
neg:function(a){return new z(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new z(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new z(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new z(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=
b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var f=a[0],n=a[1],p=a[2],s=a[3],u=b[0],y=b[1],A=b[2],B=b[3];return new z(s*u+f*B+n*A-p*y,s*y+n*B+p*u-f*A,s*A+p*B+f*y-n*u,s*B-f*u-n*y-p*A)},$mulQuat:function(a,b){var f=a[0],n=a[1],p=a[2],s=a[3],u=b[0],y=b[1],A=b[2],B=b[3];a[0]=s*u+f*B+n*A-p*y;a[1]=s*y+n*B+p*u-f*A;a[2]=s*A+p*B+f*y-n*u;a[3]=s*B-f*u-n*y-p*A;return a},divQuat:function(a,b){var f=a[0],n=a[1],p=a[2],s=a[3],u=b[0],y=b[1],A=b[2],B=b[3],C=1/(B*B+u*u+y*y+A*A);return new z((f*B-s*u-n*
A+p*y)*C,(f*A-s*y+n*B-p*u)*C,(n*u+p*B-s*A-f*y)*C,(s*B+f*u+n*y+p*A)*C)},$divQuat:function(a,b){var f=a[0],n=a[1],p=a[2],s=a[3],u=b[0],y=b[1],A=b[2],B=b[3],C=1/(B*B+u*u+y*y+A*A);a[0]=(f*B-s*u-n*A+p*y)*C;a[1]=(f*A-s*y+n*B-p*u)*C;a[2]=(n*u+p*B-s*A-f*y)*C;a[3]=(s*B+f*u+n*y+p*A)*C;return a},invert:function(a){var b=a[0],f=a[1],n=a[2];a=a[3];var p=1/(b*b+f*f+n*n+a*a);return new z(-b*p,-f*p,-n*p,a*p)},$invert:function(a){var b=a[0],f=a[1],n=a[2],p=a[3],s=1/(b*b+f*f+n*n+p*p);a[0]=-b*s;a[1]=-f*s;a[2]=-n*s;
a[3]=p*s;return a},norm:function(a){var b=a[0],f=a[1],n=a[2];a=a[3];return w(b*b+f*f+n*n+a*a)},normSq:function(a){var b=a[0],f=a[1],n=a[2];a=a[3];return b*b+f*f+n*n+a*a},unit:function(a){return z.scale(a,1/z.norm(a))},$unit:function(a){return z.$scale(a,1/z.norm(a))},conjugate:function(a){return new z(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};q=z.prototype={};for(v in k){z[v]=k[v];q[v]=function(a){return function(){var b=d.call(arguments);b.unshift(this);
return z[a].apply(z,b)}}(v)}j.fromQuat=function(a){return new j(a[0],a[1],a[2])};z.fromVec3=function(a,b){return new z(a[0],a[1],a[2],b||0)};z.fromMat4=function(a){var b,f,n;if(a[0]>a[5]&&a[0]>a[10]){b=0;f=1;n=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;f=2;n=0}else{b=2;f=0;n=1}var p=w(1+a[b*5]-a[f*5]-a[n*5]),s=new z;s[b]=0.5*p;s[f]=0.5*(a["n"+f+""+b]+a["n"+b+""+f])/p;s[n]=0.5*(a["n"+b+""+n]+a["n"+n+""+b])/p;s[3]=0.5*(a["n"+f+""+n]-a["n"+n+""+f])/p;return s};z.fromXRotation=function(a){return new z(l(a/
2),0,0,m(a/2))};z.fromYRotation=function(a){return new z(0,l(a/2),0,m(a/2))};z.fromZRotation=function(a){return new z(0,0,l(a/2),m(a/2))};z.fromAxisRotation=function(a,b){var f=a[0],n=a[1],p=a[2],s=1/w(f*f+n*n+p*p),u=l(b/2),y=m(b/2);return new z(u*f*s,u*n*s,u*p*s,y)};r.fromQuat=function(a){var b=a[3],f=a[0],n=a[1];a=a[2];return new r(b*b+f*f-n*n-a*a,2*f*n-2*b*a,2*f*a+2*b*n,0,2*f*n+2*b*a,b*b-f*f+n*n-a*a,2*n*a-2*b*f,0,2*f*a-2*b*n,2*n*a+2*b*f,b*b-f*f-n*n+a*a,0,0,0,0,1)};PhiloGL.Vec3=j;PhiloGL.Mat4=r;
PhiloGL.Quat=z})();(function(){function x(e){return e!==true?e:false}var w=function(e){e=e.getBoundingClientRect();return{x:e.left,y:e.top,bbox:e}},l={get:function(e,d){return e||(d||window).event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},getKey:function(e){var d=e.which||e.keyCode,g;a:{g=i.Keys;for(var c in g)if(g[c]==d){g=c;break a}g=void 0}c=d-111;if(c>0&&c<13)g="f"+c;g=g||String.fromCharCode(d).toLowerCase();return{code:d,key:g,shift:e.shiftKey,control:e.ctrlKey,
alt:e.altKey,meta:e.metaKey}},isRightClick:function(e){return e.which==3||e.button==2},getPos:function(e,d){d=d||window;e=e||d.event;var g=d.document,c;g=g.documentElement||g.body;if(e.touches&&e.touches.length){c=[];for(var h=0,j=e.touches.length,k;h<j;++h){k=e.touches[h];c.push({x:k.pageX||k.clientX+g.scrollLeft,y:k.pageY||k.clientY+g.scrollTop})}return c}return[{x:e.pageX||e.clientX+g.scrollLeft,y:e.pageY||e.clientY+g.scrollTop}]},stop:function(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=
true;if(e.preventDefault)e.preventDefault();else e.returnValue=false}},m=function(e,d){var g=e.canvas;this.scene=e.scene;this.domElem=g;this.pos=w(g);this.opt=this.callbacks=d;this.size={width:g.width||g.offsetWidth,height:g.height||g.offsetHeight};this.attachEvents()};m.prototype={hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,moved:false,attachEvents:function(){var e=this.domElem,d=this.opt,g=this;if(d.disableContextMenu)e.oncontextmenu=function(){return false};
if(d.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(h){e.addEventListener(h,function(j,k){g[h](g.eventInfo(h,j,k))},false)});var c="";c=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";e.addEventListener(c,function(h,j){g.mousewheel(g.eventInfo("mousewheel",h,j))},false)}d.enableTouch&&["touchstart","touchmove","touchend"].forEach(function(h){e.addEventListener(h,function(j,k){g[h](g.eventInfo(h,j,k))},false)});d.enableKeyboard&&
["keydown","keyup"].forEach(function(h){document.addEventListener(h,function(j,k){g[h](g.eventInfo(h,j,k))},false)})},eventInfo:function(e,d,g){var c=this.domElem,h=this.scene,j=this.opt,k=this.getSize(),q=j.relative,v=j.centerOrigin,r=j.cachePosition&&this.pos||w(c),z=l.get(d,g);d=l.getPos(d,g);var a={x:d[0].x,y:d[0].y};g={};for(var b,f=0,n=d.length;f<n;++f){c=d[f].x;b=d[f].y;if(q){c-=r.x;b-=r.y;if(v){c-=k.width/2;b-=k.height/2;b*=-1}}d[f].x=c;d[f].y=b}switch(e){case "mousewheel":g.wheel=l.getWheel(z);
break;case "keydown":case "keyup":t.extend(g,l.getKey(z));break;case "mouseup":g.isRightClick=l.isRightClick(z)}var p;t.extend(g,{x:d[0].x,y:d[0].y,posArray:d,cache:false,stop:function(){l.stop(z)},getTarget:function(){if(p)return p;return p=j.picking&&h.pick(a.x-r.x,a.y-r.y)||true}});g.event=z;return g},getSize:function(){if(this.cacheSize)return this.size;var e=this.domElem;return{width:e.width||e.offsetWidth,height:e.height||e.offsetHeight}},mouseup:function(e){if(!this.moved)if(e.isRightClick)this.callbacks.onRightClick(e,
this.hovered);else this.callbacks.onClick(e,x(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(e,x(this.pressed));else this.callbacks.onDragCancel(e,x(this.pressed));this.pressed=this.moved=false}},mouseout:function(e){for(var d=e.relatedTarget,g=this.domElem;d&&d.parentNode;){if(g==d.parentNode)return;d=d.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=
false}},mouseover:function(){},mousemove:function(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,x(this.pressed))}else{if(this.hovered){var d=x(e.getTarget());if(!d||d.hash!=this.hash){this.callbacks.onMouseLeave(e,this.hovered);if(this.hash=this.hovered=d){this.hash=d.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else this.callbacks.onMouseMove(e,this.hovered)}else if(this.hash=this.hovered=x(e.getTarget())){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}if(!this.opt.picking)this.callbacks.onMouseMove(e)}},
mousewheel:function(e){this.callbacks.onMouseWheel(e)},mousedown:function(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,x(this.pressed))},touchstart:function(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,x(this.touched))},touchmove:function(e){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(e,x(this.touched))}},touchend:function(e){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(e,x(this.touched));else{e.x=
isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,x(this.touched));this.callbacks.onTouchCancel(e,x(this.touched))}this.touched=this.touchMoved=false}},keydown:function(e){this.callbacks.onKeyDown(e)},keyup:function(e){this.callbacks.onKeyUp(e)}};var i={};i.create=function(e,d){d=t.extend({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,lazyPicking:false,enableTouch:true,
enableMouse:true,enableKeyboard:true,onClick:t.empty,onRightClick:t.empty,onDragStart:t.empty,onDragMove:t.empty,onDragEnd:t.empty,onDragCancel:t.empty,onTouchStart:t.empty,onTouchMove:t.empty,onTouchEnd:t.empty,onTouchCancel:t.empty,onTap:t.empty,onMouseMove:t.empty,onMouseEnter:t.empty,onMouseLeave:t.empty,onMouseWheel:t.empty,onKeyDown:t.empty,onKeyUp:t.empty},d||{});var g=d.bind;if(g)for(var c in d)c.match(/^on[a-zA-Z0-9]+$/)&&function(h,j){d[h]=function(){return j.apply(g,Array.prototype.slice.call(arguments))}}(c,
d[c]);new m(e,d);e.events=d};i.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=i})();(function(){function x(d,g){return t.merge(g||{},d.length==2?{vs:d[0],fs:d[1]}:d[0]||{})}var w=function(d,g,c){var h=d.createShader(c);if(h==null)throw"Error creating the shader with shader type: "+c;d.shaderSource(h,g);d.compileShader(h);if(!d.getShaderParameter(h,d.COMPILE_STATUS)){g=d.getShaderInfoLog(h);d.deleteShader(h);throw"Error while compiling the shader "+
g;}return h},l=function(d){var g=d.lastIndexOf("/");return g=="/"?"./":d.substr(0,g+1)},m=function(d,g,c,h,j){j=j||{};var k;if(k=g.match(/#include "(.*?)"/)){var q=PhiloGL.IO.XHR,v=l(d)+k[1];j[v]&&h("Recursive include");(new q({url:v,noCache:true,onError:function(r){h("Load included file `"+v+"` failed: Code "+r)},onSuccess:function(r){j[v]=true;return m(v,r,function(z){delete j[v];g=g.replace(/#include ".*?"/,z);g=g.replace(/\sHAS_EXTENSION\s*\(\s*([A-Za-z_\-0-9]+)\s*\)/g,function(a,b){return o.getExtension(b)?
" 1 ":" 0 "});return m(v,g,c,h,j)},h,j)}})).send();return null}else return c(g)},i=function(d,g,c){var h=o.getUniformLocation(d,g.name);d=g.type;var j=false,k=true,q,v;if(g.size>1&&c)switch(d){case o.FLOAT:q=o.uniform1fv;v=Float32Array;k=false;break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:q=o.uniform1iv;v=Uint16Array;k=false}if(k)switch(d){case o.FLOAT:q=o.uniform1f;break;case o.FLOAT_VEC2:q=o.uniform2fv;v=c?Float32Array:new Float32Array(2);break;case o.FLOAT_VEC3:q=o.uniform3fv;
v=c?Float32Array:new Float32Array(3);break;case o.FLOAT_VEC4:q=o.uniform4fv;v=c?Float32Array:new Float32Array(4);break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:q=o.uniform1i;break;case o.INT_VEC2:case o.BOOL_VEC2:q=o.uniform2iv;v=c?Uint16Array:new Uint16Array(2);break;case o.INT_VEC3:case o.BOOL_VEC3:q=o.uniform3iv;v=c?Uint16Array:new Uint16Array(3);break;case o.INT_VEC4:case o.BOOL_VEC4:q=o.uniform4iv;v=c?Uint16Array:new Uint16Array(4);break;case o.FLOAT_MAT2:j=true;q=o.uniformMatrix2fv;
break;case o.FLOAT_MAT3:j=true;q=o.uniformMatrix3fv;break;case o.FLOAT_MAT4:j=true;q=o.uniformMatrix4fv}q=q.bind(o);return c&&v?function(r){q(h,new v(r))}:j?function(r){q(h,false,r.toFloat32Array())}:v?function(r){v.set(r.toFloat32Array?r.toFloat32Array():r);q(h,v)}:function(r){q(h,r)};throw"Unknown type: "+d;},e=function(d,g){var c=o,h=c.createProgram();c.attachShader(h,w(c,d,c.VERTEX_SHADER));c.attachShader(h,w(c,g,c.FRAGMENT_SHADER));c.linkProgram(h);if(!c.getProgramParameter(h,c.LINK_STATUS))throw"Error linking the shader: "+
c.getProgramInfoLog(h);if(!h)return false;c={};for(var j={},k,q,v=o.getProgramParameter(h,o.ACTIVE_ATTRIBUTES),r=0;r<v;r++){k=o.getActiveAttrib(h,r);q=k.name;k=o.getAttribLocation(h,k.name);c[q]=k}v=o.getProgramParameter(h,o.ACTIVE_UNIFORMS);for(r=0;r<v;r++){k=o.getActiveUniform(h,r);q=k.name;q=q[q.length-1]=="]"?q.substr(0,q.length-3):q;j[q]=i(h,k,k.name!=q)}this.program=h;this.attributes=c;this.attributeEnabled={};this.uniforms=j};e.prototype={$$family:"program",setUniform:function(d,g){if(this.uniforms[d])this.uniforms[d](g);
return this},setUniforms:function(d){for(var g in d)this.setUniform(g,d[g]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){e.prototype[d]=function(){var g=Array.prototype.slice.call(arguments);g.unshift(this);L[d].apply(L,g);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){e.prototype[d]=function(){L[d].apply(L,arguments);return this}});e.fromShaderIds=function(){var d=x(arguments),g=t(d.vs),
c=t(d.fs);return m(d.path,g.innerHTML,function(h){return m(d.path,c.innerHTML,function(j){d.onSuccess(new e(h,j),d)})})};e.fromShaderSources=function(){var d=x(arguments,{path:"./"});return m(d.path,d.vs,function(g){return m(d.path,d.fs,function(c){try{var h=new e(g,c);if(d.onSuccess)d.onSuccess(h,d);else return h}catch(j){if(d.onError)d.onError(j,d);else throw j;}})})};e.fromDefaultShaders=function(d){d=d||{};var g=d.fs||"Default",c=PhiloGL.Shaders;d.vs=c.Vertex[d.vs||"Default"];d.fs=c.Fragment[g];
return PhiloGL.Program.fromShaderSources(d)};e.fromShaderURIs=function(d){d=t.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:t.empty,onError:t.empty},d||{});var g=d.path+d.vs,c=d.path+d.fs;(new PhiloGL.IO.XHR.Group({urls:[g,c],noCache:d.noCache,onError:function(h){d.onError(h)},onComplete:function(h){try{return m(g,h[0],function(k){return m(c,h[1],function(q){d.vs=k;d.fs=q;return e.fromShaderSources(d)},d.onError)},d.onError)}catch(j){d.onError(j,d)}}})).send()};PhiloGL.Program=e})();(function(){var x=
{},w=function(i){this.opt=i=t.merge({url:"http://philogljs.org/",method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false,onProgress:t.empty,onSuccess:t.empty,onError:t.empty,onAbort:t.empty,onComplete:t.empty},i||{});this.initXHR()};w.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(i,e){w.State[i]=e});w.prototype={initXHR:function(){var i=this.req=new XMLHttpRequest,e=this;["Progress","Error","Abort","Load"].forEach(function(d){if(i.addEventListener)i.addEventListener(d.toLowerCase(),
function(g){e["handle"+d](g)},false);else i["on"+d.toLowerCase()]=function(g){e["handle"+d](g)}})},send:function(i){var e=this.req,d=this.opt,g=d.async;if(d.noCache)d.url+=(d.url.indexOf("?")>=0?"&":"?")+t.uid();e.open(d.method,d.url,g);if(d.responseType)e.responseType=d.responseType;if(g)e.onreadystatechange=function(){if(e.readyState==w.State.COMPLETED)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)};d.sendAsBinary?e.sendAsBinary(i||d.body||null):
e.send(i||d.body||null);if(!g)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)},setRequestHeader:function(i,e){this.req.setRequestHeader(i,e);return this},handleProgress:function(i){if(i.lengthComputable)this.opt.onProgress(i,Math.round(i.loaded/i.total*100));else this.opt.onProgress(i,-1)},handleError:function(i){this.opt.onError(i)},handleAbort:function(i){this.opt.onAbort(i)},handleLoad:function(i){this.opt.onComplete(i)}};w.Group=function(i){function e(j){return function(k){--c;
i.onError(k,j);if(!c)i.onComplete(h)}}function d(j){return function(k){--c;h[j]=k;i.onSuccess(k,j);if(!c)i.onComplete(h)}}i=t.merge({urls:[],onError:t.empty,onSuccess:t.empty,onComplete:t.empty,method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false},i||{});var g=t.splat(i.urls),c=g.length,h=Array(c);this.reqs=g.map(function(j,k){return new w({url:j,method:i.method,async:i.async,noCache:i.noCache,sendAsBinary:i.sendAsBinary,responseType:i.responseType,body:i.body,onError:e(k),
onSuccess:d(k)})})};w.Group.prototype={send:function(){for(var i=0,e=this.reqs,d=e.length;i<d;++i)e[i].send()}};var l=function(i){i=t.merge({url:"http://philogljs.org/",data:{},noCache:false,onComplete:t.empty,callbackKey:"callback"},i||{});var e=l.counter++,d=[],g;for(g in i.data)d.push(g+"="+i.data[g]);d=d.join("&");if(i.noCache)d+=(d.indexOf("?")>=0?"&":"?")+t.uid();d=i.url+(i.url.indexOf("?")>-1?"&":"?")+i.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+e+(d.length>0?"&"+d:"");var c=document.createElement("script");
c.type="text/javascript";c.src=d;l.requests["request_"+e]=function(h){i.onComplete(h);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};l.counter=0;l.requests={};var m=function(i){i=t.merge({src:[],noCache:false,onProgress:t.empty,onComplete:t.empty},i||{});var e=0,d=i.src.length,g=function(){i.onProgress(Math.round(++e/d*100));if(e==d)i.onComplete(k)},c=function(){if(++e==d)i.onComplete(k)},h=i.noCache,j=t.uid(),
k=i.src.map(function(q,v){var r=new Image;r.index=v;r.onload=g;r.onerror=c;r.src=q+(h?(q.indexOf("?")>=0?"&":"?")+j:"");return r});return k};x.XHR=w;x.JSONP=l;x.Images=m;x.Textures=function(i){i=t.merge({src:[],noCache:false,onComplete:t.empty},i||{});m({src:i.src,noCache:i.noCache,onComplete:function(e){var d={};e.forEach(function(g,c){d[i.id&&i.id[c]||i.src&&i.src[c]]=t.merge({data:{value:g}},i)});L.setTextures(d);i.onComplete()}})};PhiloGL.IO=x})();(function(){var x=PhiloGL.Vec3,w=PhiloGL.Mat4,
l=function(m,i,e,d,g){g=g||{};var c=g.position,h=g.target,j=g.up;this.type=g.type?g.type:"perspective";this.fov=m;this.near=e;this.far=d;this.aspect=i;this.position=c&&new x(c.x,c.y,c.z)||new x;this.target=h&&new x(h.x,h.y,h.z)||new x;this.up=j&&new x(j.x,j.y,j.z)||new x(0,1,0);if(this.type=="perspective")this.projection=(new w).perspective(m,i,e,d);else{m=e*Math.tan(m*Math.PI/360);g=-m;this.projection=(new w).ortho(g*i,m*i,g,m,e,d)}this.view=new w};l.prototype={update:function(){if(this.type=="perspective")this.projection=
(new w).perspective(this.fov,this.aspect,this.near,this.far);else{var m=this.near*Math.tan(this.fov*Math.PI/360),i=-m,e=i*this.aspect,d=m*this.aspect;this.projection=(new w).ortho(e,d,i,m,this.near,this.far)}this.view.lookAt(this.position,this.target,this.up)},setStatus:function(m){var i=this.position,e=this.view,d=this.projection,g=e.mulMat4(d),c=g.invert();m.setUniforms({cameraPosition:[i.x,i.y,i.z],projectionMatrix:d,viewMatrix:e,viewProjectionMatrix:g,viewInverseMatrix:e.invert(),viewProjectionInverseMatrix:c})}};
PhiloGL.Camera=l})();(function(){function x(c,h){if(c&&c.length<h){for(var j=c[0],k=c[1],q=c[2],v=c[3],r=[j,k,q,v],z=h/c.length,a;--z;){a=z*4;r[a]=j;r[a+1]=k;r[a+2]=q;r[a+3]=v}return new Float32Array(r)}else return c}var w=PhiloGL.Vec3,l=PhiloGL.Mat4,m=Math.cos,i=Math.sin,e=Math.PI,d=Array.prototype.slice,g={attributeMap:{position:"vertices",normal:"normals",pickingColor:"pickingColors",colors:"color"}};g.Model=function(c){c=c||{};this.id=c.id||t.uid();this.pickable=!!c.pickable;this.pick=c.pick||
function(){return false};this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&t.splat(c.textures);this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;this.reflection=c.reflection||0;this.refraction=c.refraction||0;if(c.pickingColors)this.pickingColors=c.pickingColors;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType||"TRIANGLES";this.display="display"in c?
c.display:true;this.onBeforeRender=c.onBeforeRender||t.empty;this.onAfterRender=c.onAfterRender||t.empty;if(c.program)this.program=c.program;this.position=new w;this.rotation=new w;this.scale=new w(1,1,1);this.matrix=new l;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};g.Model.prototype=Object.create(null,{hash:{get:function(){return this.id+" "+this.$pickingIndex}},vertices:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==
h)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=h}else{delete this.$vertices;delete this.$verticesLength}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==h)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=h}else{delete this.$normals;delete this.$normalsLength}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var h=
c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==h)this.$colors.set(c);else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=h)this.$colors=x(d.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}else{delete this.$colors;delete this.$colorsLength}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==
h)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=h)this.$pickingColors=x(d.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}else{delete this.$pickingColors;delete this.$pickingColorsLength}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(t.type(c)=="object"){var h={},j;for(j in c){var k=c[j];h[j]=k.BYTES_PER_ELEMENT?k:new Float32Array(k)}this.$texCoords=
h}else{h=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==h)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=h}else{delete this.$texCoords;delete this.$texCoordsLength}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==h)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=h}else{delete this.$indices;
delete this.$indicesLength}},get:function(){return this.$indices}}});t.extend(g.Model.prototype,{$$family:"model",update:function(){var c=this.matrix,h=this.position,j=this.rotation,k=this.scale;c.id();c.$translate(h.x,h.y,h.z);c.$rotateXYZ(j.x,j.y,j.z);c.$scale(k.x,k.y,k.z)},computeCentroids:function(){var c=this.vertices,h=[];this.faces.forEach(function(j){var k=[0,0,0],q=0;j.forEach(function(v){v=c[v];k[0]+=v[0];k[1]+=v[1];k[2]+=v[2];q++});k[0]/=q;k[1]/=q;k[2]/=q;h.push(k)});this.centroids=h},
computeNormals:function(){var c=this.vertices,h=[];this.faces.forEach(function(j){var k=c[j[0]],q=c[j[1]];j=c[j[2]];k={x:k[0]-q[0],y:k[1]-q[1],z:k[2]-q[2]};w.$cross(k,{x:j[0]-q[0],y:j[1]-q[1],z:j[1]-q[2]});w.norm(k)>1.0E-6&&w.unit(k);h.push([k.x,k.y,k.z])});this.normals=h}});t.extend(g.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var h=this.attributes,j;for(j in h){var k=h[j],q=this.id+"-"+j;if(Object.keys(k).length){k.attribute=j;c.setBuffer(q,
k);delete k.value}else c.setBuffer(q,true)}},setVertices:function(c){if(this.$vertices)this.dynamic?c.setBuffer("position-"+this.id,{attribute:"position",value:this.$vertices,size:3}):c.setBuffer("position-"+this.id)},setNormals:function(c){if(this.$normals)this.dynamic?c.setBuffer("normal-"+this.id,{attribute:"normal",value:this.$normals,size:3}):c.setBuffer("normal-"+this.id)},setIndices:function(c){if(this.$indices)this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:o.ELEMENT_ARRAY_BUFFER,
drawType:o.STATIC_DRAW,value:this.$indices,size:1}):c.setBuffer("indices-"+this.id)},setPickingColors:function(c){if(this.$pickingColors)this.dynamic?c.setBuffer("pickingColor-"+this.id,{attribute:"pickingColor",value:this.$pickingColors,size:4}):c.setBuffer("pickingColor-"+this.id)},setColors:function(c){if(this.$colors)this.dynamic?c.setBuffer("color-"+this.id,{attribute:"color",value:this.$colors,size:4}):c.setBuffer("color-"+this.id)},setTexCoords:function(c){if(this.$texCoords){var h=this.id,
j,k,q,v;if(this.dynamic)if(t.type(this.$texCoords)=="object"){j=0;k=this.textures;for(q=k.length;j<q;j++){v=k[j];c.setBuffer("texCoord-"+j+"-"+h,{attribute:"texCoord"+(j+1),value:this.$texCoords[v],size:2})}}else c.setBuffer("texCoord-"+h,{attribute:"texCoord1",value:this.$texCoords,size:2});else if(t.type(this.$texCoords)=="object"){j=0;k=this.textures;for(q=k.length;j<q;j++)c.setBuffer("texCoord-"+j+"-"+h)}else c.setBuffer("texCoord-"+h)}},setTextures:function(c){this.textures=this.textures?t.splat(this.textures):
[];for(var h=0,j=this.textures,k=j.length,q=PhiloGL.Scene.MAX_TEXTURES;h<q;h++){if(h<k)if(L.textureMemo[j[h]].isCube){c.setUniform("hasTextureCube"+(h+1),true);c.setTexture(j[h],o["TEXTURE"+(h+5)])}else{c.setUniform("hasTexture"+(h+1),true);c.setTexture(j[h],o["TEXTURE"+h])}else{c.setUniform("hasTextureCube"+(h+1),false);c.setUniform("hasTexture"+(h+1),false)}c.setUniform("sampler"+(h+1),h);c.setUniform("samplerCube"+(h+1),h+5)}},setState:function(c){this.setUniforms(c);this.setAttributes(c);this.setVertices(c);
this.setColors(c);this.setPickingColors(c);this.setNormals(c);this.setTextures(c);this.setTexCoords(c);this.setIndices(c)},unsetState:function(c){c=c.attributes;o.bindBuffer(o.ARRAY_BUFFER,null);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null);for(var h in c)o.disableVertexAttribArray(c[h])}});g.Cube=function(c){g.Model.call(this,t.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,
-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};g.Cube.prototype=Object.create(g.Model.prototype);g.Sphere=function(c){var h=c.nlat||10,j=
c.nlong||10,k=c.radius||1,q=e-0,v=2*e-0,r=(h+1)*(j+1),z=new Float32Array(r*3),a=new Float32Array(r*3);r=new Float32Array(r*2);var b=new Uint16Array(h*j*6);if(typeof k=="number"){var f=k;k=function(){return f}}for(var n=0;n<=h;n++)for(var p=0;p<=j;p++){var s=p/j,u=n/h,y=v*s,A=q*u,B=i(y);y=m(y);var C=i(A),D=m(A);A=y*C;y=D;B*=C;C=k(A,y,B,s,u);D=p+n*(j+1);var F=D*3;D*=2;z[F+0]=C*A;z[F+1]=C*y;z[F+2]=C*B;a[F+0]=A;a[F+1]=y;a[F+2]=B;r[D+0]=s;r[D+1]=u}k=h+1;for(p=0;p<h;p++)for(n=0;n<j;n++){D=(p*j+n)*6;b[D+
0]=n*k+p;b[D+1]=n*k+p+1;b[D+2]=(n+1)*k+p;b[D+3]=(n+1)*k+p;b[D+4]=n*k+p+1;b[D+5]=(n+1)*k+p+1}g.Model.call(this,t.extend({vertices:z,indices:b,normals:a,texCoords:r},c||{}))};g.Sphere.prototype=Object.create(g.Model.prototype);g.IcoSphere=function(c){var h=c.iterations||0,j=[],k=[],q=Math.sqrt,v=Math.acos,r=Math.atan2,z=Math.PI,a=z*2;c.onAddVertex=c.onAddVertex||t.empty;var b=(1+q(5))/2,f=q(1+b*b);j.push(-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,0,0,-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,b/f,0,-1/
f,b/f,0,1/f,-b/f,0,-1/f,-b/f,0,1/f);k.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var n=function(){var V={};return function(R,S){R*=3;S*=3;var W=(R<S?R:S)+"|"+(R>S?R:S);if(W in V)return V[W];var N=(j[R]+j[S])/2,X=(j[R+1]+j[S+1])/2,Y=(j[R+2]+j[S+2])/2,Z=q(N*N+X*X+Y*Y);N/=Z;X/=Z;Y/=Z;j.push(N,X,Y);return V[W]=j.length/3-1}}();for(b=0;b<h;b++){var p=[],s=0;for(f=k.length;s<f;s+=3){var u=n(k[s],k[s+1]),y=n(k[s+
1],k[s+2]),A=n(k[s+2],k[s]);p.push(k[s],u,A,k[s+1],y,u,k[s+2],A,y,u,y,A)}k=p}f=k.length;h=new Float32Array(f*3);n=new Float32Array(f*2);for(b=0;b<f;b+=3){y=k[b];A=k[b+1];var B=k[b+2];p=y*3;s=A*3;u=B*3;y*=2;A*=2;B*=2;var C=j[p],D=j[p+1],F=j[p+2],H=v(F/q(C*C+D*D+F*F)),I=r(D,C);H/=z;I=1-I/a;var G=j[s],E=j[s+1],M=j[s+2],J=v(M/q(G*G+E*E+M*M)),K=r(E,G);J/=z;K=1-K/a;var O=j[u],P=j[u+1],Q=j[u+2],T=v(Q/q(O*O+P*P+Q*Q)),U=r(P,O);T/=z;U=1-U/a;C=w.cross({x:O-G,y:P-E,z:Q-M},{x:C-G,y:D-E,z:F-M}).$unit();h[p]=h[s]=
h[u]=C.x;h[p+1]=h[s+1]=h[u+1]=C.y;h[p+2]=h[s+2]=h[u+2]=C.z;n[y]=I;n[y+1]=H;n[A]=K;n[A+1]=J;n[B]=U;n[B+1]=T}g.Model.call(this,t.extend({vertices:j,indices:k,normals:h,texCoords:n},c||{}))};g.IcoSphere.prototype=Object.create(g.Model.prototype);g.TruncatedCone=function(c){var h=c.bottomRadius||0,j=c.topRadius||0,k=c.height||1,q=c.nradial||10,v=c.nvertical||10,r=!!c.topCap,z=!!c.bottomCap,a=(r?2:0)+(z?2:0),b=(q+1)*(v+1+a),f=new Float32Array(b*3),n=new Float32Array(b*3);b=new Float32Array(b*2);var p=
new Uint16Array(q*(v+a)*6),s=q+1,u=Math,y=u.atan2(h-j,k),A=u.sin,B=u.cos;u=u.PI;var C=B(y);y=A(y);z=v+(z?2:0);var D=0,F=0;for(r=r?-2:0;r<=z;r++){var H=r/v,I=k*H,G;if(r<0){I=0;H=1;G=h}else if(r>v){I=k;H=1;G=j}else G=h+(j-h)*(r/v);if(r==-2||r==v+2)H=G=0;I-=k/2;for(var E=0;E<s;E++){var M=A(E*u*2/q),J=B(E*u*2/q);f[D+0]=M*G;f[D+1]=I;f[D+2]=J*G;n[D+0]=r<0||r>v?0:M*C;n[D+1]=r<0?-1:r>v?1:y;n[D+2]=r<0||r>v?0:J*C;b[F+0]=E/q;b[F+1]=H;F+=2;D+=3}}for(r=0;r<v+a;r++)for(E=0;E<q;E++){h=(r*q+E)*6;p[h+0]=s*(r+0)+0+
E;p[h+1]=s*(r+0)+1+E;p[h+2]=s*(r+1)+1+E;p[h+3]=s*(r+0)+0+E;p[h+4]=s*(r+1)+1+E;p[h+5]=s*(r+1)+0+E}g.Model.call(this,t.extend({vertices:f,normals:n,texCoords:b,indices:p},c||{}))};g.TruncatedCone.prototype=Object.create(g.Model.prototype);g.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;g.TruncatedCone.call(this,c)};g.Cone.prototype=Object.create(g.TruncatedCone.prototype);g.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;g.TruncatedCone.call(this,
c)};g.Cylinder.prototype=Object.create(g.TruncatedCone.prototype);g.Plane=function(c){var h=c.type,j=h.split(","),k=c[j[0]+"len"],q=c[j[1]+"len"],v=c["n"+j[0]]||1;j=c["n"+j[1]]||1;var r=c.offset,z=!!c.flipCull,a=(v+1)*(j+1),b=new Float32Array(a*3),f=new Float32Array(a*3);a=new Float32Array(a*2);var n=0,p=0;if(z)k=-k;for(var s=0;s<=j;s++)for(var u=0;u<=v;u++){var y=u/v,A=s/j;a[n+0]=z?1-y:y;a[n+1]=A;n+=2;switch(h){case "x,y":b[p+0]=k*y-k*0.5;b[p+1]=q*A-q*0.5;b[p+2]=r;f[p+0]=0;f[p+1]=0;f[p+2]=z?1:-1;
break;case "x,z":b[p+0]=k*y-k*0.5;b[p+1]=r;b[p+2]=q*A-q*0.5;f[p+0]=0;f[p+1]=z?1:-1;f[p+2]=0;break;case "y,z":b[p+0]=r;b[p+1]=k*y-k*0.5;b[p+2]=q*A-q*0.5;f[p+0]=z?1:-1;f[p+1]=0;f[p+2]=0}p+=3}h=v+1;k=[];for(s=0;s<j;s++)for(u=0;u<v;u++){q=(s*v+u)*6;k[q+0]=(s+0)*h+u;k[q+1]=(s+1)*h+u;k[q+2]=(s+0)*h+u+1;k[q+3]=(s+1)*h+u;k[q+4]=(s+1)*h+u+1;k[q+5]=(s+0)*h+u+1}g.Model.call(this,t.extend({vertices:b,normals:f,texCoords:a,indices:k},c))};g.Plane.prototype=Object.create(g.Model.prototype);g.id=t.time();PhiloGL.O3D=
g})();(function(){var x={Vertex:{},Fragment:{}},w=x.Fragment;x.Vertex.Default="#define LIGHT_MAX 4\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nuniform bool useReflection;\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = worldMatrix * vec4(position, 1.0);\nvec4 transformedNormal = worldInverseTransposeMatrix * vec4(normal, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nif (useReflection) {\nvReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.0))).xyz;\n} else {\nvReflection = vec3(1.0, 1.0, 1.0);\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\nvNormal = transformedNormal;\ngl_Position = projectionMatrix * worldMatrix * vec4(position, 1.0);\n}";
w.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform float reflection;\nuniform float refraction;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif (!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasTextureCube1) {\nvec3 nReflection = normalize(vReflection);\nvec3 reflectionValue;\nif (refraction > 0.0) {\nreflectionValue = refract(nReflection, vNormal.xyz, refraction);\n} else {\nreflectionValue = -reflect(nReflection, vNormal.xyz);\n}\nvec4 cubeColor = textureCube(samplerCube1, vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\ngl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n}\nif (enablePicking) {\nif (hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=x})();(function(){var x=PhiloGL.Vec3,w=function(l,m,i){i=t.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},i||{});this.program=i.program?l[i.program]:l;this.camera=m;this.models=[];this.config=i};w.prototype={add:function(){for(var l=0,m=this.models,i=arguments.length;l<i;l++){var e=arguments[l];e.id=e.id||t.uid();m.push(e);this.defineBuffers(e)}},remove:function(l){var m=this.models;l=m.indexOf(l);
l>-1&&m.splice(l,1)},getProgram:function(l){var m=this.program;if(m.$$family!="program"&&l&&l.program){m=m[l.program];m.use()}return m},defineBuffers:function(l){var m=this.getProgram(l),i=l.dynamic;l.dynamic=true;l.setState(m);l.dynamic=i;l.unsetState(m)},beforeRender:function(l){this.setupLighting(l);this.setupEffects(l);this.camera&&this.camera.setStatus(l)},setupLighting:function(l){var m=this.config.lights,i=m.ambient,e=m.directional,d=e.color,g=e.direction,c=m.enable;m=m.points&&t.splat(m.points)||
[];e=m.length;var h=[],j=[],k=[],q=[];g=(new x(g.x,g.y,g.z)).$unit().$scale(-1);l.setUniform("enableLights",c);if(c){l.setUniform("ambientColor",[i.r,i.g,i.b]);l.setUniform("directionalColor",[d.r,d.g,d.b]);l.setUniform("lightingDirection",[g.x,g.y,g.z]);l.setUniform("numberPoints",e);for(i=0;i<e;i++){c=m[i];d=c.position;g=c.color||c.diffuse;c=c.specular;h.push(d.x,d.y,d.z);j.push(g.r,g.g,g.b);k.push(+!!c);c?q.push(c.r,c.g,c.b):q.push(0,0,0)}if(h.length){l.setUniforms({pointLocation:h,pointColor:j});
l.setUniforms({enableSpecular:k,pointSpecularColor:q})}}},setupEffects:function(l){var m=this.config.effects.fog,i=m.color||{r:0.5,g:0.5,b:0.5};m?l.setUniforms({hasFog:true,fogNear:m.near,fogFar:m.far,fogColor:[i.r,i.g,i.b]}):l.setUniform("hasFog",false)},render:function(l){l=l||{};var m=this.camera,i=this.program,e=l.renderProgram,d=t.type(i);d=!e&&d=="object";l=t.extend({onBeforeRender:t.empty,onAfterRender:t.empty},l||{});!d&&this.beforeRender(e||i);for(var g=0,c=this.models,h=c.length;g<h;++g){var j=
c[g];if(j.display){i=e||this.getProgram(j);d&&this.beforeRender(i);j.onBeforeRender(i,m);l.onBeforeRender(j,g);this.renderObject(j,i);l.onAfterRender(j,g);j.onAfterRender(i,m)}}},renderToTexture:function(l,m){m=m||{};var i=L.textures[l+"-texture"],e=L.textureMemo[l+"-texture"];this.render(m);o.bindTexture(e.textureType,i)},renderObject:function(l,m){var i=this.camera,e=l.matrix,d=i.view.mulMat4(e),g=d.invert(),c=g.transpose();l.setState(m);m.setUniforms({objectMatrix:e,worldMatrix:d,worldInverseMatrix:g,
worldInverseTransposeMatrix:c});if(l.render)l.render(o,m,i);else l.$indicesLength?o.drawElements(l.drawType!==undefined?o.get(l.drawType):o.TRIANGLES,l.$indicesLength,o.UNSIGNED_SHORT,0):o.drawArrays(l.drawType!==undefined?o.get(l.drawType):o.TRIANGLES,0,l.$verticesLength/3);l.unsetState(m)},setupPicking:function(){var l=PhiloGL.Program.fromDefaultShaders();L.setFrameBuffer("$picking",{width:5,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",
value:"LINEAR"},{name:"TEXTURE_WRAP_S",value:"CLAMP_TO_EDGE"},{name:"TEXTURE_WRAP_T",value:"CLAMP_TO_EDGE"}]},bindToRenderBuffer:true});L.setFrameBuffer("$picking",false);this.pickingProgram=l},pick:function(l,m,i){i=i||{};this.pickingProgram||this.setupPicking();var e={},d=[],g=L.usedProgram,c=this.pickingProgram,h=this.camera,j=h.target,k=h.aspect,q=this.config,v=q.lights.enable,r=q.effects.fog,z=o.canvas;i=i.viewport||{};var a=i.width||z.offsetWidth||z.width;z=i.height||z.offsetHeight||z.height;
var b=this.unproject([(l-(i.x||0))*2/a-1,1-(m-(i.y||0))*2/z,1],h),f=new Uint8Array(4);this.camera.target=b;this.camera.update();q.lights.enable=false;q.effects.fog=false;L.setFrameBuffer("$picking",true);c.use();c.setUniform("enablePicking",true);o.disable(o.BLEND);o.viewport(0,0,5,1);o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);o.readPixels(0,0,1,1,o.RGBA,o.UNSIGNED_BYTE,f);this.renderPickingScene({background:f[0]+f[1]*256+f[2]*65536,o3dHash:e,o3dList:d,hash:[]});o.readPixels(2,0,1,1,o.RGBA,o.UNSIGNED_BYTE,
f);var n=[f[0],f[1],f[2]].join();b=e[n];console.log("o3dHash",n,l,m,a,z);if(!b){m=0;for(n=d.length;m<n;m++){b=d[m];l=b.pick(f);if(l!==false)b.$pickingIndex=l;else b=false}}L.setFrameBuffer("$picking",false);L.setTexture("$picking-texture",false);c.setUniform("enablePicking",false);q.lights.enable=v;q.effects.fog=r;g&&g.use();o.viewport(i.x||0,i.y||0,a,z);h.target=j;h.aspect=k;h.update();this.o3dHash=e;this.o3dList=d;this.pixel=f;this.capture=void 0;return b&&b.pickable&&b},unproject:function(l,m){return m.view.invert().mulMat4(m.projection.invert()).mulVec3(l)},
renderPickingScene:function(l){if(this.config.renderPickingScene)this.config.renderPickingScene.call(this,l);else{var m=this.pickingProgram,i=l.o3dHash,e=l.o3dList,d=l.background,g=l.hash,c=0;this.renderToTexture("$picking",{renderProgram:m,onBeforeRender:function(h,j){if(j==d)c=1;var k=j+c,q=!!h.pickingColors;m.setUniform("hasPickingColors",q);if(q)e.push(h);else{g[0]=k%256;g[1]=(k/256>>0)%256;g[2]=(k/65536>>0)%256;m.setUniform("pickColor",[g[0]/255,g[1]/255,g[2]/255]);i[g.join()]=h}}})}},resetPicking:t.empty};
w.MAX_TEXTURES=10;w.MAX_POINT_LIGHTS=4;w.PICKING_RES=4;PhiloGL.Scene=w})();(function(){function x(w,l){for(var m=this.workers=[];l--;)m.push(new Worker(w))}x.prototype={map:function(w){var l=this.workers,m=this.configs=[],i=0;for(l=l.length;i<l;i++)m.push(w&&w(i));return this},reduce:function(w){for(var l=w.reduceFn,m=this.workers,i=this.configs,e=m.length,d=w.initialValue,g=function(k){e--;d=d===undefined?k.data:l(d,k.data);if(e==0)w.onComplete(d)},c=0,h=e;c<h;c++){var j=m[c];j.onmessage=g;j.postMessage(i[c])}return this}};
PhiloGL.WorkerGroup=x})();(function(){var x=function(d){this.opt=t.merge({delay:0,duration:1E3,transition:function(g){return g},onCompute:t.empty,onComplete:t.empty},d||{})},w=x.Queue=[];x.prototype={time:null,start:function(d){this.opt=t.merge(this.opt,d||{});this.time=t.time();this.animating=true;w.push(this)},step:function(){if(this.animating){var d=t.time(),g=this.time,c=this.opt,h=c.delay,j=c.duration,k=0;if(d<g+h)c.onCompute.call(this,k);else if(d<g+h+j){k=c.transition((d-g-h)/j);c.onCompute.call(this,
k)}else{this.animating=false;c.onCompute.call(this,1);c.onComplete.call(this)}}}};x.compute=function(d,g,c){return d+(g-d)*c};x.Transition={linear:function(d){return d}};var l=x.Transition;(function(){var d=function(h,j){j=t.splat(j);return t.extend(h,{easeIn:function(k){return h(k,j)},easeOut:function(k){return 1-h(1-k,j)},easeInOut:function(k){return k<=0.5?h(2*k,j)/2:(2-h(2*(1-k),j))/2}})},g={Pow:function(h,j){return Math.pow(h,j[0]||6)},Expo:function(h){return Math.pow(2,8*(h-1))},Circ:function(h){return 1-
Math.sin(Math.acos(h))},Sine:function(h){return 1-Math.sin((1-h)*Math.PI/2)},Back:function(h,j){j=j[0]||1.618;return Math.pow(h,2)*((j+1)*h-j)},Bounce:function(h){for(var j,k=0,q=1;;k+=q,q/=2)if(h>=(7-4*k)/11){j=q*q-Math.pow((11-6*k-11*h)/4,2);break}return j},Elastic:function(h,j){return Math.pow(2,10*--h)*Math.cos(20*h*Math.PI*(j[0]||1)/3)}},c;for(c in g)l[c]=d(g[c]);["Quad","Cubic","Quart","Quint"].forEach(function(h,j){l[h]=d(function(k){return Math.pow(k,[j+2])})})})();var m=self||window,i=function(){var d=
w;w=[];if(d.length){for(var g=0,c=d.length,h;g<c;g++){h=d[g];h.step();h.animating&&w.push(h)}x.Queue=w}};if(m){var e=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in m){x.animationTime=function(){return m[d]};e=true}});if(!e)x.animationTime=t.time;e=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in m){x.requestAnimationFrame=
function(g){m[d](function(){i();g()})};e=true}});if(!e)x.requestAnimationFrame=function(d){setTimeout(function(){i();d()},1E3/60)}}PhiloGL.Fx=x})();(function(){var x={},w=function(){};w.postProcess=function(){var l=new PhiloGL.O3D.Plane({type:"x,y",xlen:1,ylen:1,offset:0}),m=new PhiloGL.Camera(45,1,0.1,500,{position:{x:0,y:0,z:1.205}}),i=new PhiloGL.Scene({},m);return function(e){var d=L.program.$$family?L.program:L.program[e.program],g=e.fromTexture?t.splat(e.fromTexture):[],c=e.toFrameBuffer,h=
!!e.toScreen,j=e.width||L.canvas.width,k=e.height||L.canvas.height,q=e.viewportX||0,v=e.viewportY||0;m.aspect=e.aspectRatio?e.aspectRatio:Math.max(k/j,j/k);m.update();i.program=d;l.textures=g;l.program=d;i.models.length||i.add(l);if(c){c in L.frameBufferMemo||L.setFrameBuffer(c,{width:j,height:k,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:false});d.use();L.setFrameBuffer(c,true);o.viewport(q,
v,j,k);o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);d.setUniforms(e.uniforms||{});i.renderToTexture(c);L.setFrameBuffer(c,false)}if(h){d.use();o.viewport(q,v,j,k);o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);d.setUniforms(e.uniforms||{});i.render()}return this}}();x.Image=w;PhiloGL.Media=x})()})();
